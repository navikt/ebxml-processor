version: "3"

services:
  roundcube:
    container_name: asyncreceivers-mailclient
    build: docker/roundcube
    environment:
      - IMPORT_FROM_VOLUME=true
      - ROUNDCUBEMAIL_DEFAULT_HOST=greenmail  # IMAP server - tls:// prefix for STARTTLS, ssl:// for SSL/TLS
      - ROUNDCUBEMAIL_DEFAULT_PORT=3143       # IMAP port
      - ROUNDCUBEMAIL_SMTP_SERVER=greenmail   # SMTP server - tls:// prefix for STARTTLS, ssl:// for SSL/TLS
      - ROUNDCUBEMAIL_SMTP_PORT=3025          # SMTP port
    ports:
      - "8000:80"
  mq:
    container_name: asyncreceivers-mq-admin
    build: docker/mq
    restart: always
    environment:
      LICENSE: accept
      MQ_QMGR_NAME: QM1
      MQ_APP_PASSWORD: passw0rd
    volumes:
      - ./docker/mq/config.mqsc:/etc/mqm/20-config.mqsc
    ports:
      - "1414:1414"
      - "9443:9443"
  greenmail:
    container_name: asyncreceivers-mailserver
    build: docker/greenmail
    environment:
      - JAVA_OPTS=-Dgreenmail.verbose -Dgreenmail.users=peder:peder@epost.com,thomas:thomas@epost.com
    ports:
      - "3025:3025" #SMTP
      - "3110:3110" #POP3
      - "3143:3143" #IMAP
      - "3465:3465" #SMTPS
      - "3993:3993" #IMAPS
      - "3995:3995" #POP3s
      - "8081:8080" #GreenMail API
  kafka:
    container_name: asyncreceivers-kafka
    image: 'bitnami/kafka:latest'
    restart: on-failure
    hostname: localhost
    ports:
      - '9092:9092'
    volumes:
      - "kafka_data:/bitnami"
    environment:
      - KAFKA_ADVERTISED_HOST_NAME=localhost
      # KRaft settings
      - KAFKA_CFG_NODE_ID=0
      - KAFKA_CFG_PROCESS_ROLES=controller,broker
      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=0@kafka:9093
      # Listeners
      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093
      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://:9092
      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT
      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER
      - KAFKA_CFG_INTER_BROKER_LISTENER_NAME=PLAINTEXT
volumes:
  kafka_data:
    driver: local
